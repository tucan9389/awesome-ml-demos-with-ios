#import <Foundation/Foundation.h>

@class FIRApp;
@class FIRModelInputOutputOptions;
@class FIRModelInputs;
@class FIRModelOptions;
@class FIRModelOutputs;

NS_ASSUME_NONNULL_BEGIN

/**
 * A block containing an array of custom model inference outputs, or nil if there's an error.
 *
 * @param outputs An array of results of model inference. Returns nil when there is an error.
 * @param error The error, if any, while running the custom model inference, including
 *     `MachineLearningErrorDomainCode.InvalidArgument` when:
 *     - `options` are nil.
 *     - Either input or outoutput data formats in `options` are empty.
 *     - The number of inputs do not match the data options.
 *     - The input byte buffer does not have the expected size.
 *     - The input data is neither a byte buffer (`NSData`) nor an array.
 *     - The input dimension does not match the input format specified in `options`.
 *     - The input element type in the data options is unexpected.
 *     - The input element type is not a number as specified in the data options.
 *     - The input type specified in the data options does not match the model.
 *     - Dimension of input data does not match the data options.
 *     - An element type in the data options does not match the actual output.
 *     - The total size in bytes specified in the data options does not match the actual output.
 *     - The number of dimensions in the data options does not match the actual output.
 *     - The shape in the data optinos does not match the actual output.
 *     - The output element type in the data options is unexpected.
 *     `MachineLearningErrorDomainCode.OutOfRange` when:
 *     - An input index in `options` is out of range.
 *     - An output index in `options` is out of range.
 *     `MachineLearningErrorDomainCode.Unknown` when:
 *     - No output was generated by the custom model.
 *     - There are no tensors matching an output index in the data options.
 *     `MachineLearningErrorDomainCode.Internal` when:
 *     - An input tensor cannot be located.
 */
typedef void (^FIRModelInterpreterRunCallback)(
    FIRModelOutputs * _Nullable outputs,
    NSError * _Nullable error) NS_SWIFT_NAME(ModelInterpreterRunCallback);

/**
 * A block containing the index for an input or an output op.
 *
 * @param index The index, as an `unsignedIntValue`, for an input or output op or `nil` if there was
 * an error.
 * @param error An error while getting the index or `nil`.
 */
typedef void (^FIRModelInterpreterInputOutputOpIndexCallback)(NSNumber *_Nullable index,
                                                              NSError *_Nullable error)
    NS_SWIFT_NAME(ModelInterpreterInputOutputOpIndexCallback);

/**
 * A Firebase interpreter for a custom model.
 */
NS_SWIFT_NAME(ModelInterpreter)
@interface FIRModelInterpreter : NSObject

/**
 * Gets an instance of a custom model interpreter with the given options and the default Firebase
 * app. The default Firebase app instance must be configured before calling this method; otherwise,
 * raises `FIRAppNotConfigured` exception. The returned interpreter is thread safe. Custom models
 * hosted in non-default Firebase apps are currently not supported.
 *
 * @param options The options of the custom model file.
 * @return A custom model interpreter with the given options and the default Firebase app.
 */
+ (instancetype)modelInterpreterWithOptions:(FIRModelOptions *)options;

/**
 * Runs model inference with the given inputs and data options asynchronously. Inputs and data
 * options should remain unchanged until the model inference completes.
 *
 * @param inputs Inputs for custom model inference.
 * @param options Data options for the custom model specifiying input and output data types and
 *     dimensions.
 * @param completion Handler to call back on the main thread with `ModelOutputs` or error.
 */
- (void)runWithInputs:(FIRModelInputs *)inputs
              options:(FIRModelInputOutputOptions *)options
           completion:(FIRModelInterpreterRunCallback)completion
    NS_SWIFT_NAME(run(inputs:options:completion:));

/**
 * Gets the index of an input op with the given name.
 *
 * @param opName The name of the input op.
 * @param completion Handler to call back on the main thread with input op index as an
 *     `unsignedIntValue` or error.
 */
- (void)inputIndexForOp:(NSString *)opName
             completion:(FIRModelInterpreterInputOutputOpIndexCallback)completion
    NS_SWIFT_NAME(inputIndex(opName:completion:));

/**
 * Gets the index of an output op with the given name.
 *
 * @param opName The name of the output op.
 * @param completion Handler to call back on the main thread with output op index as an
 *     `unsignedIntValue` or error.
 */
- (void)outputIndexForOp:(NSString *)opName
              completion:(FIRModelInterpreterInputOutputOpIndexCallback)completion
    NS_SWIFT_NAME(outputIndex(opName:completion:));

@end

NS_ASSUME_NONNULL_END
